# 🗜️ 代码压缩工具使用说明

## 📋 工具介绍

本工具包含两个版本的代码压缩程序，可以压缩HTML、CSS、JavaScript代码，减少文件大小，同时保持功能和结构完整。

### 工具文件说明

- `compress.py` - 基础版压缩工具
- `compress_advanced.py` - 高级版压缩工具（支持配置文件）
- `compress_config.json` - 压缩配置文件
- `compress.bat` - Windows批处理启动脚本

## 🚀 快速开始

### 方法一：使用批处理脚本（推荐Windows用户）

1. 双击运行 `compress.bat`
2. 按照提示输入源目录和输出目录
3. 确认开始压缩

### 方法二：使用Python脚本

#### 基础版使用方法

```bash
python compress.py
```

#### 高级版使用方法

```bash
# 使用默认设置
python compress_advanced.py

# 指定源目录和输出目录
python compress_advanced.py ./source ./output

# 使用自定义配置文件
python compress_advanced.py -c my_config.json

# 创建备份
python compress_advanced.py -b

# 跳过确认直接执行
python compress_advanced.py -y
```

## ⚙️ 配置文件说明

`compress_config.json` 文件包含以下配置选项：

### 压缩设置 (compression_settings)

```json
{
  "html": {
    "enabled": true,              // 是否压缩HTML
    "remove_comments": true,      // 删除注释
    "remove_whitespace": true,    // 删除多余空白
    "preserve_tags": ["pre", "textarea", "script", "style"]  // 保留这些标签内的空白
  },
  "css": {
    "enabled": true,              // 是否压缩CSS
    "remove_comments": true,      // 删除注释
    "remove_whitespace": true,    // 删除多余空白
    "minify_selectors": true      // 压缩选择器
  },
  "js": {
    "enabled": true,              // 是否压缩JavaScript
    "remove_comments": true,      // 删除注释
    "remove_whitespace": true,    // 删除多余空白
    "preserve_strings": true,     // 保留字符串
    "preserve_regex": true        // 保留正则表达式
  }
}
```

### 文件设置 (file_settings)

```json
{
  "skip_patterns": [              // 跳过的文件/目录模式
    "node_modules",
    ".git",
    "__pycache__",
    "*.min.js",                   // 跳过已经压缩的文件
    "*.min.css"
  ],
  "binary_extensions": [          // 二进制文件扩展名
    ".jpg", ".png", ".gif", ".ico",
    ".pdf", ".zip", ".rar"
  ]
}
```

### 输出设置 (output_settings)

```json
{
  "default_output_dir": "compressed",  // 默认输出目录
  "preserve_structure": true,          // 保持目录结构
  "create_backup": false               // 是否创建备份
}
```

## 📊 压缩效果

### HTML 压缩
- ✅ 删除注释（保留条件注释）
- ✅ 删除多余空白符
- ✅ 保留 `<pre>`, `<textarea>`, `<script>` 标签内的格式
- ✅ 压缩标签间的空白

### CSS 压缩
- ✅ 删除注释
- ✅ 删除多余空白符
- ✅ 压缩选择器和属性
- ✅ 删除不必要的分号

### JavaScript 压缩
- ✅ 删除单行和多行注释
- ✅ 保留字符串和正则表达式
- ✅ 删除空行和多余空白
- ✅ 保持代码功能完整

## 🛡️ 安全特性

### 功能保护
- 🔒 保留所有字符串内容
- 🔒 保留正则表达式
- 🔒 保留重要的HTML标签格式
- 🔒 不修改代码逻辑

### 文件保护
- 🔒 自动跳过二进制文件
- 🔒 可选择创建备份
- 🔒 保持目录结构
- 🔒 跳过已压缩文件

## 📈 使用示例

### 示例1：压缩当前项目

```bash
# 压缩当前目录到 compressed 文件夹
python compress_advanced.py

# 输出示例：
# ✅ index.html: 13,234 → 9,876 bytes (-25.4%)
# ✅ css/styles.css: 12,543 → 8,321 bytes (-33.7%)
# ✅ js/main.js: 24,567 → 18,234 bytes (-25.8%)
```

### 示例2：自定义压缩

```bash
# 压缩指定目录，创建备份，跳过确认
python compress_advanced.py ./src ./dist -b -y
```

### 示例3：使用自定义配置

创建 `my_config.json`：
```json
{
  "compression_settings": {
    "html": {"enabled": true, "remove_comments": false},
    "css": {"enabled": true},
    "js": {"enabled": false}
  }
}
```

运行：
```bash
python compress_advanced.py -c my_config.json
```

## 📋 压缩统计报告

工具会生成详细的压缩报告：

```
📊 压缩统计报告
================================================================================
  HTML:   3 文件 |    45,234 →    32,567 bytes | 节省   12,667 bytes ( 28.0%)
   CSS:   1 文件 |    12,543 →     8,321 bytes | 节省    4,222 bytes ( 33.7%)
    JS:   4 文件 |    89,234 →    67,890 bytes | 节省   21,344 bytes ( 23.9%)
 OTHER:   8 文件 |    23,456 →    23,456 bytes | 节省        0 bytes (  0.0%)
--------------------------------------------------------------------------------
  总计:  16 文件 |   170,467 →   132,234 bytes | 节省   38,233 bytes ( 22.4%)

🎉 压缩完成！总共节省了 38,233 bytes (22.4%)
```

## ⚠️ 注意事项

1. **备份重要文件**：压缩前建议备份重要文件
2. **测试功能**：压缩后请测试网站功能是否正常
3. **避免重复压缩**：不要压缩已经压缩过的文件
4. **Python环境**：需要Python 3.6+环境

## 🔧 故障排除

### 常见问题

**Q: 提示"未找到Python"**
A: 请安装Python 3.6+，下载地址：https://www.python.org/downloads/

**Q: 压缩后网站不能正常工作**
A: 检查是否压缩了重要的空白符，可以调整配置文件禁用某些压缩选项

**Q: 某些文件没有被压缩**
A: 检查文件是否在跳过列表中，或者是否为二进制文件

**Q: 压缩效果不明显**
A: 某些文件可能已经是压缩格式，或者代码本身就很简洁

### 获取帮助

```bash
python compress_advanced.py --help
```

## 📝 更新日志

- v1.0: 基础压缩功能
- v2.0: 添加配置文件支持、备份功能、详细统计报告

---

🎉 **祝您使用愉快！如有问题请检查配置文件或联系技术支持。**