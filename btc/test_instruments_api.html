<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交易产品信息API测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .product-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            background-color: #fff;
        }
        .product-header {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        .product-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 14px;
        }
        .detail-item {
            display: flex;
            justify-content: space-between;
        }
        .detail-label {
            font-weight: bold;
            color: #666;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .summary-card {
            background: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }
        .summary-count {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>交易产品信息API测试</h1>
    
    <div class="container">
        <h2>获取产品信息</h2>
        <div class="form-group">
            <label for="instType">产品类型:</label>
            <select id="instType">
                <option value="SPOT">现货 (SPOT)</option>
                <option value="MARGIN">币币杠杆 (MARGIN)</option>
                <option value="SWAP">永续合约 (SWAP)</option>
                <option value="FUTURES">交割合约 (FUTURES)</option>
                <option value="OPTION">期权 (OPTION)</option>
            </select>
        </div>
        <div class="form-group">
            <label for="instId">产品ID (可选):</label>
            <input type="text" id="instId" placeholder="例如: BTC-USDT">
        </div>
        <div class="form-group">
            <label for="uly">标的指数 (可选):</label>
            <input type="text" id="uly" placeholder="例如: BTC-USDT">
        </div>
        <div class="form-group">
            <label for="instFamily">交易品种 (可选):</label>
            <input type="text" id="instFamily" placeholder="例如: BTC-USDT">
        </div>
        <button onclick="getInstruments()">获取产品信息</button>
        <button onclick="getSummary()">获取产品摘要</button>
    </div>
    
    <div class="container">
        <h2>产品摘要</h2>
        <div id="summaryResult"></div>
    </div>
    
    <div class="container">
        <h2>产品详情</h2>
        <div id="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8050/api';
        
        async function getInstruments() {
            const instType = document.getElementById('instType').value;
            const instId = document.getElementById('instId').value;
            const uly = document.getElementById('uly').value;
            const instFamily = document.getElementById('instFamily').value;
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="loading">正在获取产品信息...</div>';
            
            try {
                const params = new URLSearchParams();
                params.append('instType', instType);
                if (instId) params.append('instId', instId);
                if (uly) params.append('uly', uly);
                if (instFamily) params.append('instFamily', instFamily);
                
                const response = await fetch(`${API_BASE}/instruments?${params}`);
                const data = await response.json();
                
                if (data.code === '0') {
                    displayInstruments(data.data);
                } else {
                    resultDiv.innerHTML = `<div class="result">错误: ${data.msg || '未知错误'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result">请求失败: ${error.message}</div>`;
            }
        }
        
        async function getSummary() {
            const summaryDiv = document.getElementById('summaryResult');
            summaryDiv.innerHTML = '<div class="loading">正在获取产品摘要...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/instruments/summary`);
                const data = await response.json();
                
                if (data.code === '0') {
                    displaySummary(data.data);
                } else {
                    summaryDiv.innerHTML = `<div class="result">错误: ${data.msg || '未知错误'}</div>`;
                }
            } catch (error) {
                summaryDiv.innerHTML = `<div class="result">请求失败: ${error.message}</div>`;
            }
        }
        
        function displayInstruments(instruments) {
            const resultDiv = document.getElementById('result');
            
            if (!instruments || instruments.length === 0) {
                resultDiv.innerHTML = '<div class="result">未找到产品信息</div>';
                return;
            }
            
            let html = `<div class="result">找到 ${instruments.length} 个产品</div>`;
            
            instruments.forEach(instrument => {
                html += `
                    <div class="product-card">
                        <div class="product-header">${instrument.instId}</div>
                        <div class="product-details">
                            <div class="detail-item">
                                <span class="detail-label">产品类型:</span>
                                <span>${instrument.instType}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">交易货币:</span>
                                <span>${instrument.baseCcy || '-'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">计价货币:</span>
                                <span>${instrument.quoteCcy || '-'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">结算货币:</span>
                                <span>${instrument.settleCcy || '-'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">最小下单数量:</span>
                                <span>${instrument.minSz}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">下单数量精度:</span>
                                <span>${instrument.lotSz}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">下单价格精度:</span>
                                <span>${instrument.tickSz}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">最大杠杆:</span>
                                <span>${instrument.lever || '-'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">产品状态:</span>
                                <span>${instrument.state}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">上线时间:</span>
                                <span>${new Date(parseInt(instrument.listTime)).toLocaleString()}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">标的指数:</span>
                                <span>${instrument.uly || '-'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">交易品种:</span>
                                <span>${instrument.instFamily || '-'}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            resultDiv.innerHTML = html;
        }
        
        function displaySummary(summary) {
            const summaryDiv = document.getElementById('summaryResult');
            
            let html = '<div class="summary-grid">';
            
            Object.entries(summary).forEach(([type, info]) => {
                const typeNames = {
                    'SPOT': '现货',
                    'MARGIN': '币币杠杆',
                    'SWAP': '永续合约',
                    'FUTURES': '交割合约',
                    'OPTION': '期权'
                };
                
                html += `
                    <div class="summary-card">
                        <div class="summary-count">${info.count}</div>
                        <div>${typeNames[type] || type}</div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            ${info.products.join(', ')}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            summaryDiv.innerHTML = html;
        }
        
        // 页面加载时自动获取摘要
        window.onload = function() {
            getSummary();
        };
    </script>
</body>
</html> 