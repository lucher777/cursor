<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">æ”¯ä»˜é¡µé¢ - å­¦ç”Ÿé‚®ç®±åœ¨çº¿æ”¯ä»˜ - BuyEdu</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="å®‰å…¨ä¾¿æ·çš„å­¦ç”Ÿé‚®ç®±åœ¨çº¿æ”¯ä»˜ï¼Œæ”¯æŒå¾®ä¿¡ã€æ”¯ä»˜å®ã€USDTç­‰å¤šç§æ”¯ä»˜æ–¹å¼ï¼Œè‡ªåŠ¨å‘è´§åˆ°æ‚¨çš„é‚®ç®±ã€‚">
    <meta name="keywords" content="å­¦ç”Ÿé‚®ç®±æ”¯ä»˜,edué‚®ç®±ä»˜æ¬¾,åœ¨çº¿æ”¯ä»˜,å¾®ä¿¡æ”¯ä»˜,æ”¯ä»˜å®æ”¯ä»˜">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://buyedu.cn/pay.html">
    
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- QRCodeåº“å·²ä¸å†éœ€è¦ï¼ŒTRXå’ŒUSDTç°åœ¨ä½¿ç”¨å¤–é“¾å›¾ç‰‡ -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script> -->
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .pay-page {
            background-color: #f5f5f5;
            padding: 20px 0;
            min-height: calc(100vh - 40px);
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        
        .pay-container {
            max-width: 1000px;
            width: 95%;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 0;
            text-align: center;
            overflow: hidden;
            border: 1px solid #e5e5e5;
            max-height: calc(100vh - 80px);
        }
        
        .pay-header {
            background: #2c5aa0;
            color: white;
            padding: 20px 25px;
            position: relative;
        }
        
        .pay-header h1 {
            color: white;
            margin-bottom: 5px;
            font-size: 24px;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }
        
        .pay-header p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 0;
            font-size: 14px;
            position: relative;
            z-index: 1;
        }
        

        
        .pay-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            padding: 0 20px 20px;
            height: calc(100vh - 220px);
            max-height: 580px;
        }
        
        .order-section, .payment-section {
            background: white;
            padding: 15px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .payment-section {
            overflow: visible;
        }
        
        .order-section {
            border-right: 1px solid #e9ecef;
            background: linear-gradient(135deg, #ffffff 0%, #f8fcff 100%);
        }
        
        .order-info {
            background: linear-gradient(135deg, #f8fcff 0%, #ffffff 100%);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: left;
            border: 1px solid #e3f2fd;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e3f2fd;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .order-item:hover {
            background: rgba(33, 150, 243, 0.05);
            border-radius: 6px;
            padding-left: 8px;
            padding-right: 8px;
            margin-left: -8px;
            margin-right: -8px;
        }
        
        .order-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 16px;
            color: #1976d2;
            background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
            border-radius: 8px;
            padding: 12px 8px;
            margin: 8px -8px -8px;
            border: 1px solid #2196f3;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);
        }
        
        .order-item label {
            color: #6c757d;
            font-weight: 500;
        }
        
        .order-item span {
            color: #333;
            font-weight: 600;
        }
        
        .payment-amount-warning {
            background: linear-gradient(135deg, #fff8e1 0%, #ffffff 100%);
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #f57c00;
            text-align: left;
            box-shadow: 0 2px 8px rgba(255, 193, 7, 0.15);
        }
        
        .payment-amount-warning h4 {
            margin: 0 0 10px 0;
            color: #f57c00;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
        }
        
        .payment-amount-warning p {
            margin: 6px 0;
            font-size: 12px;
            line-height: 1.4;
            font-weight: 500;
        }
        
        .amount-highlight {
            background: linear-gradient(135deg, #ff5722 0%, #f44336 100%);
            color: white !important;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 14px !important;
            display: inline-block;
            box-shadow: 0 2px 6px rgba(244, 67, 54, 0.3);
            margin: 0 3px;
        }
        
        .payment-method-tabs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .method-tab {
            padding: 12px 16px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        
        .method-tab:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .method-tab.active {
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3a6f 100%);
            color: white;
            border-color: #2c5aa0;
            box-shadow: 0 2px 8px rgba(44, 90, 160, 0.3);
        }
        
        .method-content {
            display: none;
            padding: 15px;
            background: linear-gradient(135deg, #f8fcff 0%, #ffffff 100%);
            border-radius: 8px;
            border: 1px solid #e3f2fd;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);
            flex: 1;
            overflow: visible;
            position: relative;
        }
        
        .method-content.active {
            display: flex;
            flex-direction: column;
        }
        
        .payment-address {
            margin-bottom: 8px;
        }
        
        .address-label {
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 13px;
        }
        
        .address-copy {
            display: flex;
            gap: 8px;
        }
        
        .address-copy input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .copy-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: #2c5aa0;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
        }
        
        .copy-btn:hover {
            background: #1e3a6f;
        }
        
        .qr-code-container img {
            max-width: 140px;
            height: auto;
            margin-bottom: 8px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .qr-code-container p {
            font-size: 12px;
            color: #666;
            margin: 0;
        }
        
        /* äºŒç»´ç å®¹å™¨ç›¸å¯¹å®šä½ */
        .qr-code-container {
            text-align: center;
            position: relative;
            overflow: visible;
        }
        
        /* æ”¾å¤§çš„äºŒç»´ç å åŠ å±‚ */
        .qr-enlarged {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(2.5);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            pointer-events: none;
            max-width: 140px;
            height: auto;
        }
        
        .qr-enlarged.show {
            opacity: 1;
        }
        
        .payment-timer {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 8px;
            margin: 8px 0;
            color: #856404;
            margin-top: auto;
        }
        
        .payment-timer h4 {
            margin: 0 0 6px 0;
            color: #e74c3c;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .payment-notice {
            font-size: 11px;
            color: #666;
            text-align: left;
        }
        
        .payment-notice p {
            margin: 3px 0;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 20px 15px;
            flex-wrap: wrap;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .btn-success:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(86,171,47,0.3);
        }
        
        @media (max-width: 768px) {
            .pay-page {
                padding: 10px 0;
            }
            
            .pay-container {
                width: 95%;
                margin: 0 auto;
                max-width: 600px;
            }
            
            .pay-header {
                padding: 18px 20px;
            }
            
            .pay-header h1 {
                font-size: 22px;
            }
            
            .pay-header p {
                font-size: 13px;
            }
            

            
            .pay-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 0 15px 15px;
                height: auto;
                max-height: none;
            }
            
            .order-section, .payment-section {
                padding: 15px;
                overflow-y: visible;
            }
            
            .order-section {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .order-info {
                padding: 15px;
                margin: 15px 0;
            }
            
            .order-item {
                font-size: 13px;
                padding: 6px 0;
            }
            
            .order-item:last-child {
                font-size: 16px;
                padding: 12px 6px;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
                margin: 20px 20px 20px;
            }
            
            .btn-secondary,
            .btn-success {
                width: 200px;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .pay-page {
                padding: 5px 0;
            }
            
            .pay-container {
                width: 98%;
                margin: 0 auto;
                max-width: 500px;
            }
            
            .pay-header {
                padding: 15px 12px;
            }
            
            .pay-header h1 {
                font-size: 18px;
            }
            
            .pay-header p {
                font-size: 12px;
            }
            

            
            .pay-grid {
                padding: 0 15px 15px;
            }
            
            .order-section, .payment-section {
                padding: 15px;
            }
            
            .order-info {
                padding: 12px;
                margin: 12px 0;
            }
            
            .order-item {
                font-size: 12px;
                padding: 5px 0;
            }
            
            .order-item:last-child {
                font-size: 15px;
                padding: 10px 5px;
            }
            
            .action-buttons {
                margin: 15px 15px 15px;
            }
            
            .btn-secondary,
            .btn-success {
                width: 180px;
                font-size: 13px;
                padding: 10px 25px;
            }
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="container">
            <div class="nav">
                <div class="logo" onclick="goToHome()" style="cursor: pointer;">
                    <i class="fas fa-graduation-cap"></i>
                    <span id="siteName">BuyEdu</span>
                </div>
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="è¾“å…¥å…³é”®è¯è¿›è¡Œæœç´¢...">
                    <button onclick="searchProducts()"><i class="fas fa-search"></i></button>
                </div>
                <div class="nav-buttons">
                    <button class="btn-outline" onclick="showOnlineService()">åœ¨çº¿å®¢æœ</button>
                    <button class="btn-primary" onclick="showConsultOrder()">å’¨è¯¢è®¢å•</button>
                </div>
            </div>
        </div>
    </header>

    <div class="pay-page">
        <div class="pay-container">
            <div class="pay-header">
                <h1><i class="fas fa-credit-card"></i> æ”¯ä»˜é¡µé¢</h1>
                <p>è¯·å®Œæˆæ”¯ä»˜ä»¥è·å–æ‚¨çš„å•†å“</p>
            </div>
            
            <div class="pay-grid">
                <!-- å·¦ä¾§ï¼šè®¢å•ä¿¡æ¯ -->
                <div class="order-section">
                    <h3 style="color: #333; margin-bottom: 15px; font-size: 16px; font-weight: bold;">
                        <i class="fas fa-receipt"></i> è®¢å•ä¿¡æ¯
                    </h3>
                    
                    <div class="order-info">
                        <div class="order-item">
                            <label>è®¢å•å·ï¼š</label>
                            <span id="displayOrderNumber" style="font-family: 'Courier New', monospace; font-size: 12px;">IJUSHDSMWPZXKOMF</span>
                        </div>
                        <div class="order-item">
                            <label>å•†å“åç§°ï¼š</label>
                            <span id="displayOrderName">å¸Œé›… AAS College å­¦ç”Ÿé‚®ç®± x 1</span>
                        </div>
                        <div class="order-item">
                            <label>é‚®ç®±ï¼š</label>
                            <span id="displayEmail">peacelucher@gmail.com</span>
                        </div>
                        <div class="order-item">
                            <label>æ”¯ä»˜æ–¹å¼ï¼š</label>
                            <span id="displayPaymentMethod">TRX</span>
                        </div>
                        <div class="order-item">
                            <label>æ”¯ä»˜é‡‘é¢ï¼š</label>
                            <span id="displayTotalPrice">Â¥19.80 äººæ°‘å¸</span>
                        </div>
                    </div>
                    
                    <div class="payment-amount-warning">
                        <h4>
                            <i class="fas fa-exclamation-triangle"></i>
                            é‡è¦æé†’
                        </h4>
                        <p><strong>è¯·åŠ¡å¿…ç¡®ä¿æ”¯ä»˜é‡‘é¢ä¸è®¢å•é‡‘é¢å®Œå…¨ä¸€è‡´ï¼</strong></p>
                        <p>â€¢ äººæ°‘å¸é‡‘é¢ï¼š<span id="warningAmount" class="amount-highlight">Â¥19.80</span></p>
                        <p id="cryptoAmountDisplay" style="display: none;">â€¢ åŠ å¯†è´§å¸é‡‘é¢ï¼š<span id="cryptoAmount" class="amount-highlight"></span></p>
                        <p>â€¢ å¦‚æœæ”¯ä»˜é‡‘é¢ä¸ä¸€è‡´ï¼Œå¯èƒ½å¯¼è‡´æ— æ³•è‡ªåŠ¨å‘è´§</p>
                        <p>â€¢ å› é‡‘é¢ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜ï¼Œé£é™©è‡ªç†</p>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šæ”¯ä»˜ä¿¡æ¯ -->
                <div class="payment-section">
                    <h3 style="color: #333; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                        <i class="fas fa-qrcode"></i> æ”¯ä»˜æ–¹å¼
                    </h3>
                    
                    <div class="payment-methods">
                        <div class="payment-method-tabs">
                            <button class="method-tab active" onclick="switchPaymentMethod('usdt')">USDTæ”¯ä»˜</button>
                            <button class="method-tab" onclick="switchPaymentMethod('trx')">TRXæ”¯ä»˜</button>
                            <button class="method-tab" onclick="switchPaymentMethod('alipay')">æ”¯ä»˜å®</button>
                            <button class="method-tab" onclick="switchPaymentMethod('wechat')">å¾®ä¿¡æ”¯ä»˜</button>
                        </div>
                        
                        <div class="payment-method-content">
                            <!-- USDTæ”¯ä»˜å†…å®¹ -->
                            <div id="usdtPayment" class="method-content active">
                                <div class="crypto-payment-reminder" style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 6px; padding: 10px; margin-bottom: 12px;">
                                    <h4 style="color: #1976d2; margin: 0 0 6px 0; font-size: 13px;">
                                        <i class="fas fa-info-circle"></i> USDTæ”¯ä»˜æé†’
                                    </h4>
                                    <p style="margin: 4px 0; color: #1565c0; font-weight: 500; font-size: 13px;">
                                        è¯·æ”¯ä»˜ï¼š<span id="usdtAmountReminder" style="color: #d32f2f; font-weight: bold; font-size: 15px;">è®¡ç®—ä¸­...</span>
                                    </p>
                                    <p style="margin: 4px 0; color: #666; font-size: 11px;">
                                        âš ï¸ è¯·åŠ¡å¿…ä½¿ç”¨TRC20ç½‘ç»œè½¬è´¦ï¼
                                    </p>
                                </div>
                                <div class="payment-address">
                                    <p class="address-label">USDT-TRC20åœ°å€ï¼š</p>
                                    <div class="address-copy">
                                        <input type="text" id="usdtAddressInput" readonly>
                                        <button onclick="copyAddress('usdtAddressInput')" class="copy-btn">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="qr-code-container">
                                    <img id="usdtQrCode" alt="USDTæ”¶æ¬¾ç ">
                                    <p>è¯·ä½¿ç”¨é’±åŒ…æ‰«ç æ”¯ä»˜</p>
                                    <p style="font-size: 10px; color: #999; margin-top: 4px;">ğŸ’¡ é¼ æ ‡æ‚¬åœå¯æ”¾å¤§äºŒç»´ç </p>
                                </div>
                            </div>
                            
                            <!-- TRXæ”¯ä»˜å†…å®¹ -->
                            <div id="trxPayment" class="method-content">
                                <div class="crypto-payment-reminder" style="background: #fff3e0; border: 1px solid #ff9800; border-radius: 6px; padding: 10px; margin-bottom: 12px;">
                                    <h4 style="color: #f57c00; margin: 0 0 6px 0; font-size: 13px;">
                                        <i class="fas fa-info-circle"></i> TRXæ”¯ä»˜æé†’
                                    </h4>
                                    <p style="margin: 4px 0; color: #ef6c00; font-weight: 500; font-size: 13px;">
                                        è¯·æ”¯ä»˜ï¼š<span id="trxAmountReminder" style="color: #d32f2f; font-weight: bold; font-size: 15px;">è®¡ç®—ä¸­...</span>
                                    </p>
                                    <p style="margin: 4px 0; color: #666; font-size: 11px;">
                                        ğŸ’¡ TRXè½¬è´¦æ‰‹ç»­è´¹æä½ï¼
                                    </p>
                                </div>
                                <div class="payment-address">
                                    <p class="address-label">TRXåœ°å€ï¼š</p>
                                    <div class="address-copy">
                                        <input type="text" id="trxAddressInput" readonly>
                                        <button onclick="copyAddress('trxAddressInput')" class="copy-btn">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="qr-code-container">
                                    <img id="trxQrCode" alt="TRXæ”¶æ¬¾ç ">
                                    <p>è¯·ä½¿ç”¨é’±åŒ…æ‰«ç æ”¯ä»˜</p>
                                    <p style="font-size: 10px; color: #999; margin-top: 4px;">ğŸ’¡ é¼ æ ‡æ‚¬åœå¯æ”¾å¤§äºŒç»´ç </p>
                                </div>
                            </div>
                            
                            <!-- æ”¯ä»˜å®æ”¯ä»˜å†…å®¹ -->
                            <div id="alipayPayment" class="method-content">
                                <div class="qr-code-container">
                                    <img id="alipayQrCode" alt="æ”¯ä»˜å®æ”¶æ¬¾ç ">
                                    <p>è¯·ä½¿ç”¨æ”¯ä»˜å®æ‰«ç æ”¯ä»˜</p>
                                    <p style="font-size: 10px; color: #999; margin-top: 4px;">ğŸ’¡ é¼ æ ‡æ‚¬åœå¯æ”¾å¤§äºŒç»´ç </p>
                                </div>
                            </div>
                            
                            <!-- å¾®ä¿¡æ”¯ä»˜å†…å®¹ -->
                            <div id="wechatPayment" class="method-content">
                                <div class="qr-code-container">
                                    <img id="wechatQrCode" alt="å¾®ä¿¡æ”¶æ¬¾ç ">
                                    <p>è¯·ä½¿ç”¨å¾®ä¿¡æ‰«ç æ”¯ä»˜</p>
                                    <p style="font-size: 10px; color: #999; margin-top: 4px;">ğŸ’¡ é¼ æ ‡æ‚¬åœå¯æ”¾å¤§äºŒç»´ç </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="payment-timer">
                        <h4>
                            <i class="fas fa-clock"></i>
                            æ”¯ä»˜å€’è®¡æ—¶ï¼š<span id="paymentTimer">30:00</span>
                        </h4>
                        <div class="payment-notice">
                            <p>â€¢ è¯·åœ¨30åˆ†é’Ÿå†…å®Œæˆæ”¯ä»˜ï¼Œè¶…æ—¶è®¢å•å°†è‡ªåŠ¨å–æ¶ˆ</p>
                            <p>â€¢ æ”¯ä»˜å®Œæˆåï¼Œå•†å“å°†è‡ªåŠ¨å‘è´§åˆ°æ‚¨çš„é‚®ç®±</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn-success" onclick="confirmPayment()">
                    <i class="fas fa-check"></i> æˆ‘å·²æ”¯ä»˜
                </button>
                <button class="btn-secondary" onclick="showOnlineService()">
                    <i class="fas fa-headset"></i> è”ç³»å®¢æœ
                </button>
                <a href="index.html" class="btn-secondary">
                    <i class="fas fa-home"></i> è¿”å›é¦–é¡µ
                </a>
            </div>
        </div>
    </div>

    <script>
        let config = null;
        let paymentTimer = null;
        let remainingTime = 1800; // 30åˆ†é’Ÿ = 1800ç§’
        let cryptoRates = {}; // å­˜å‚¨åŠ å¯†è´§å¸æ±‡ç‡
        
        // å¤„ç†å›¾ç‰‡URLçš„HTTP/HTTPSå…¼å®¹æ€§
        function processImageUrl(url) {
            if (!url) return url;
            
            // å¦‚æœå½“å‰é¡µé¢æ˜¯HTTPSï¼Œç¡®ä¿å›¾ç‰‡URLä¹Ÿæ˜¯HTTPS
            if (window.location.protocol === 'https:' && url.startsWith('http://')) {
                return url.replace('http://', 'https://');
            }
            
            // å¦‚æœå½“å‰é¡µé¢æ˜¯HTTPï¼Œä¿æŒåŸæ ·ï¼ˆå¯ä»¥æ˜¯HTTPæˆ–HTTPSï¼‰
            return url;
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            await loadConfig();
            updateSiteName();
            initializePaymentPage();
            
            // æ£€æŸ¥å½“å‰æ”¯ä»˜æ–¹å¼æ˜¯å¦éœ€è¦åŠ è½½æ±‡ç‡
            const orderInfo = localStorage.getItem('orderInfo');
            let needCryptoRates = true;
            if (orderInfo) {
                const order = JSON.parse(orderInfo);
                const paymentMethod = order.paymentMethod?.toLowerCase();
                // å¦‚æœæ˜¯å¾®ä¿¡æˆ–æ”¯ä»˜å®æ”¯ä»˜ï¼Œä¸éœ€è¦åŠ è½½æ±‡ç‡
                if (paymentMethod === 'wechat' || paymentMethod === 'alipay') {
                    needCryptoRates = false;
                    console.log('å½“å‰æ”¯ä»˜æ–¹å¼ä¸º', paymentMethod, 'ï¼Œè·³è¿‡æ±‡ç‡åŠ è½½');
                }
            }
            
            if (needCryptoRates) {
                await loadCryptoRates(); // åŠ è½½åŠ å¯†è´§å¸æ±‡ç‡
            }
            
            startPaymentTimer();
            
            // å»¶è¿Ÿåˆå§‹åŒ–äºŒç»´ç æ‚¬åœåŠŸèƒ½
            setTimeout(initQrCodeHover, 500);
        });
        
        // åŠ è½½é…ç½®
        async function loadConfig() {
            try {
                // å…ˆå°è¯•ä»localStorageåŠ è½½é…ç½®
                const savedConfig = localStorage.getItem('buyedu_config');
                if (savedConfig) {
                    try {
                        config = JSON.parse(savedConfig);
                        console.log('ä»localStorageåŠ è½½é…ç½®æˆåŠŸ:', config);
                    } catch (e) {
                        console.error('è§£ælocalStorageé…ç½®å¤±è´¥:', e);
                        // å¦‚æœè§£æå¤±è´¥ï¼Œå°è¯•ä»æ–‡ä»¶åŠ è½½
                        const response = await fetch('data/config.json');
                        config = await response.json();
                    }
                } else {
                    // å¦‚æœlocalStorageæ²¡æœ‰é…ç½®ï¼Œä»æ–‡ä»¶åŠ è½½
                    const response = await fetch('data/config.json');
                    config = await response.json();
                }
                
                // è®¾ç½®USDTåœ°å€å’ŒäºŒç»´ç 
                if (config.usdtQrCode) {
                    // ä¼˜å…ˆä½¿ç”¨å¤–é“¾äºŒç»´ç å›¾ç‰‡ï¼Œå¤„ç†HTTP/HTTPSå…¼å®¹æ€§
                    const usdtImg = document.getElementById('usdtQrCode');
                    const processedUrl = processImageUrl(config.usdtQrCode);
                    usdtImg.src = processedUrl;
                    usdtImg.onerror = function() {
                        console.error('USDTäºŒç»´ç åŠ è½½å¤±è´¥:', processedUrl);
                        // å¦‚æœHTTPSå¤±è´¥ï¼Œå°è¯•HTTPï¼ˆä»…åœ¨HTTPç¯å¢ƒä¸‹ï¼‰
                        if (processedUrl.startsWith('https://') && window.location.protocol === 'http:') {
                            const httpUrl = processedUrl.replace('https://', 'http://');
                            console.log('å°è¯•HTTPç‰ˆæœ¬:', httpUrl);
                            this.src = httpUrl;
                            this.onerror = function() {
                                console.error('HTTPç‰ˆæœ¬ä¹Ÿå¤±è´¥:', httpUrl);
                                this.style.display = 'none';
                                this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                            };
                        } else {
                            this.style.display = 'none';
                            this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                        }
                    };
                    console.log('USDTäºŒç»´ç URL:', processedUrl);
                }
                
                // è®¾ç½®USDTåœ°å€
                if (config.usdtAddress) {
                    document.getElementById('usdtAddressInput').value = config.usdtAddress;
                    console.log('USDTåœ°å€:', config.usdtAddress);
                }
                
                // è®¾ç½®TRXåœ°å€å’ŒäºŒç»´ç 
                if (config.trxQrCode) {
                    // ä¼˜å…ˆä½¿ç”¨å¤–é“¾äºŒç»´ç å›¾ç‰‡ï¼Œå¤„ç†HTTP/HTTPSå…¼å®¹æ€§
                    const trxImg = document.getElementById('trxQrCode');
                    const processedUrl = processImageUrl(config.trxQrCode);
                    trxImg.src = processedUrl;
                    trxImg.onerror = function() {
                        console.error('TRXäºŒç»´ç åŠ è½½å¤±è´¥:', processedUrl);
                        // å¦‚æœHTTPSå¤±è´¥ï¼Œå°è¯•HTTPï¼ˆä»…åœ¨HTTPç¯å¢ƒä¸‹ï¼‰
                        if (processedUrl.startsWith('https://') && window.location.protocol === 'http:') {
                            const httpUrl = processedUrl.replace('https://', 'http://');
                            console.log('å°è¯•HTTPç‰ˆæœ¬:', httpUrl);
                            this.src = httpUrl;
                            this.onerror = function() {
                                console.error('HTTPç‰ˆæœ¬ä¹Ÿå¤±è´¥:', httpUrl);
                                this.style.display = 'none';
                                this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                            };
                        } else {
                            this.style.display = 'none';
                            this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                        }
                    };
                    console.log('TRXäºŒç»´ç URL:', processedUrl);
                } else if (config.usdtQrCode) {
                    // å¦‚æœæ²¡æœ‰å•ç‹¬çš„TRXäºŒç»´ç ï¼Œä½¿ç”¨USDTäºŒç»´ç 
                    const trxImg = document.getElementById('trxQrCode');
                    const processedUrl = processImageUrl(config.usdtQrCode);
                    trxImg.src = processedUrl;
                    trxImg.onerror = function() {
                        console.error('TRXä½¿ç”¨USDTäºŒç»´ç åŠ è½½å¤±è´¥:', processedUrl);
                        // å¦‚æœHTTPSå¤±è´¥ï¼Œå°è¯•HTTPï¼ˆä»…åœ¨HTTPç¯å¢ƒä¸‹ï¼‰
                        if (processedUrl.startsWith('https://') && window.location.protocol === 'http:') {
                            const httpUrl = processedUrl.replace('https://', 'http://');
                            console.log('å°è¯•HTTPç‰ˆæœ¬:', httpUrl);
                            this.src = httpUrl;
                            this.onerror = function() {
                                console.error('HTTPç‰ˆæœ¬ä¹Ÿå¤±è´¥:', httpUrl);
                                this.style.display = 'none';
                                this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                            };
                        } else {
                            this.style.display = 'none';
                            this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                        }
                    };
                    console.log('TRXä½¿ç”¨USDTäºŒç»´ç URL:', processedUrl);
                }
                
                // è®¾ç½®TRXåœ°å€
                if (config.trxAddress) {
                    document.getElementById('trxAddressInput').value = config.trxAddress;
                    console.log('TRXåœ°å€:', config.trxAddress);
                } else if (config.usdtAddress) {
                    // å¦‚æœæ²¡æœ‰å•ç‹¬çš„TRXåœ°å€ï¼Œä½¿ç”¨USDTåœ°å€
                    document.getElementById('trxAddressInput').value = config.usdtAddress;
                    console.log('TRXä½¿ç”¨USDTåœ°å€:', config.usdtAddress);
                }
                
                // è®¾ç½®æ”¯ä»˜å®å’Œå¾®ä¿¡æ”¶æ¬¾ç 
                if (config.alipayQrCode) {
                    const alipayImg = document.getElementById('alipayQrCode');
                    const processedUrl = processImageUrl(config.alipayQrCode);
                    alipayImg.src = processedUrl;
                    alipayImg.onerror = function() {
                        console.error('æ”¯ä»˜å®äºŒç»´ç åŠ è½½å¤±è´¥:', processedUrl);
                        // å¦‚æœHTTPSå¤±è´¥ï¼Œå°è¯•HTTPï¼ˆä»…åœ¨HTTPç¯å¢ƒä¸‹ï¼‰
                        if (processedUrl.startsWith('https://') && window.location.protocol === 'http:') {
                            const httpUrl = processedUrl.replace('https://', 'http://');
                            console.log('å°è¯•HTTPç‰ˆæœ¬:', httpUrl);
                            this.src = httpUrl;
                            this.onerror = function() {
                                console.error('HTTPç‰ˆæœ¬ä¹Ÿå¤±è´¥:', httpUrl);
                                this.style.display = 'none';
                                this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                            };
                        } else {
                            this.style.display = 'none';
                            this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                        }
                    };
                    console.log('æ”¯ä»˜å®äºŒç»´ç URL:', processedUrl);
                }
                // ä¿®å¤å¾®ä¿¡å­—æ®µåä¸åŒ¹é…é—®é¢˜
                if (config.wechatPayQrCode) {
                    const wechatImg = document.getElementById('wechatQrCode');
                    const processedUrl = processImageUrl(config.wechatPayQrCode);
                    wechatImg.src = processedUrl;
                    wechatImg.onerror = function() {
                        console.error('å¾®ä¿¡äºŒç»´ç åŠ è½½å¤±è´¥:', processedUrl);
                        // å¦‚æœHTTPSå¤±è´¥ï¼Œå°è¯•HTTPï¼ˆä»…åœ¨HTTPç¯å¢ƒä¸‹ï¼‰
                        if (processedUrl.startsWith('https://') && window.location.protocol === 'http:') {
                            const httpUrl = processedUrl.replace('https://', 'http://');
                            console.log('å°è¯•HTTPç‰ˆæœ¬:', httpUrl);
                            this.src = httpUrl;
                            this.onerror = function() {
                                console.error('HTTPç‰ˆæœ¬ä¹Ÿå¤±è´¥:', httpUrl);
                                this.style.display = 'none';
                                this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                            };
                        } else {
                            this.style.display = 'none';
                            this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                        }
                    };
                    console.log('å¾®ä¿¡äºŒç»´ç URL:', processedUrl);
                } else if (config.wechatQrCode) {
                    // å‘åå…¼å®¹ï¼šå¦‚æœä½¿ç”¨çš„æ˜¯æ—§çš„å­—æ®µå
                    const wechatImg = document.getElementById('wechatQrCode');
                    const processedUrl = processImageUrl(config.wechatQrCode);
                    wechatImg.src = processedUrl;
                    wechatImg.onerror = function() {
                        console.error('å¾®ä¿¡äºŒç»´ç åŠ è½½å¤±è´¥:', processedUrl);
                        // å¦‚æœHTTPSå¤±è´¥ï¼Œå°è¯•HTTPï¼ˆä»…åœ¨HTTPç¯å¢ƒä¸‹ï¼‰
                        if (processedUrl.startsWith('https://') && window.location.protocol === 'http:') {
                            const httpUrl = processedUrl.replace('https://', 'http://');
                            console.log('å°è¯•HTTPç‰ˆæœ¬:', httpUrl);
                            this.src = httpUrl;
                            this.onerror = function() {
                                console.error('HTTPç‰ˆæœ¬ä¹Ÿå¤±è´¥:', httpUrl);
                                this.style.display = 'none';
                                this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                            };
                        } else {
                            this.style.display = 'none';
                            this.parentNode.innerHTML += '<p style="color: red;">äºŒç»´ç åŠ è½½å¤±è´¥</p>';
                        }
                    };
                    console.log('å¾®ä¿¡äºŒç»´ç URL(æ—§å­—æ®µ):', processedUrl);
                }
                
                console.log('é…ç½®åŠ è½½å®Œæˆ:', config);
                console.log('æ”¯ä»˜æ–¹å¼:', config.paymentMethods);
                
                // è°ƒè¯•ä¿¡æ¯ï¼šæ£€æŸ¥äºŒç»´ç é…ç½®
                console.log('=== äºŒç»´ç é…ç½®æ£€æŸ¥ ===');
                console.log('æ”¯ä»˜å®äºŒç»´ç :', config.alipayQrCode || 'æœªé…ç½®');
                console.log('å¾®ä¿¡äºŒç»´ç (wechatPayQrCode):', config.wechatPayQrCode || 'æœªé…ç½®');
                console.log('å¾®ä¿¡äºŒç»´ç (wechatQrCode):', config.wechatQrCode || 'æœªé…ç½®');
                console.log('USDTåœ°å€:', config.usdtAddress || 'æœªé…ç½®');
                console.log('USDTäºŒç»´ç :', config.usdtQrCode || 'æœªé…ç½®');
                console.log('TRXåœ°å€:', config.trxAddress || 'æœªé…ç½®');
                console.log('TRXäºŒç»´ç :', config.trxQrCode || 'æœªé…ç½®');
                console.log('========================');
            } catch (error) {
                console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
            }
        }
        
        // è·å–åŠ å¯†è´§å¸æ±‡ç‡
        async function loadCryptoRates() {
            try {
                console.log('æ­£åœ¨è·å–åŠ å¯†è´§å¸æ±‡ç‡...');
                
                // é¦–å…ˆå°è¯•å¤šä¸ªAPIæº
                const apiSources = [
                    {
                        url: 'https://api.coingecko.com/api/v3/simple/price?ids=tron,tether&vs_currencies=cny',
                        parser: (data) => ({
                            trx: data.tron?.cny,
                            usdt: data.tether?.cny
                        })
                    },
                    // å¤‡ç”¨APIæº1 - ä½¿ç”¨CORSä»£ç†
                    {
                        url: 'https://api.allorigins.win/get?url=' + encodeURIComponent('https://api.coingecko.com/api/v3/simple/price?ids=tron,tether&vs_currencies=cny'),
                        parser: (data) => {
                            const contents = JSON.parse(data.contents);
                            return {
                                trx: contents.tron?.cny,
                                usdt: contents.tether?.cny
                            };
                        }
                    }
                ];
                
                let success = false;
                
                // å°è¯•æ¯ä¸ªAPIæº
                for (let i = 0; i < apiSources.length && !success; i++) {
                    try {
                        console.log(`å°è¯•APIæº ${i + 1}:`, apiSources[i].url);
                        
                        const response = await fetch(apiSources[i].url, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                            },
                            // è®¾ç½®è¶…æ—¶
                            signal: AbortSignal.timeout(10000)
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        const data = await response.json();
                        const rates = apiSources[i].parser(data);
                        
                        if (rates.trx && rates.usdt && rates.trx > 0 && rates.usdt > 0) {
                            cryptoRates.trx = rates.trx; // TRXå¯¹äººæ°‘å¸æ±‡ç‡
                            cryptoRates.usdt = rates.usdt; // USDTå¯¹äººæ°‘å¸æ±‡ç‡
                            
                            console.log('åŠ å¯†è´§å¸æ±‡ç‡è·å–æˆåŠŸ:', cryptoRates);
                            
                            // æ›´æ–°æ˜¾ç¤ºçš„åŠ å¯†è´§å¸é‡‘é¢
                            updateCryptoAmountDisplay();
                            success = true;
                        } else {
                            throw new Error('æ±‡ç‡æ•°æ®æ ¼å¼é”™è¯¯æˆ–æ•°å€¼æ— æ•ˆ');
                        }
                    } catch (apiError) {
                        console.warn(`APIæº ${i + 1} å¤±è´¥:`, apiError.message);
                        if (i === apiSources.length - 1) {
                            throw apiError;
                        }
                    }
                }
                
            } catch (error) {
                console.error('æ‰€æœ‰æ±‡ç‡APIæºéƒ½å¤±è´¥:', error);
                
                // ä½¿ç”¨å¤‡ç”¨æ±‡ç‡ï¼ˆæ‰‹åŠ¨è®¾ç½®çš„å¤§æ¦‚å€¼ï¼‰
                cryptoRates.trx = 0.62; // 1 TRX â‰ˆ 0.62 CNY (å¤‡ç”¨å€¼)
                cryptoRates.usdt = 7.25; // 1 USDT â‰ˆ 7.25 CNY (å¤‡ç”¨å€¼)
                
                console.log('ä½¿ç”¨å¤‡ç”¨æ±‡ç‡:', cryptoRates);
                updateCryptoAmountDisplay();
                
                // æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯
                showRateWarning();
            }
        }
        
        // æ˜¾ç¤ºæ±‡ç‡è·å–å¤±è´¥è­¦å‘Š
        function showRateWarning() {
            const warningDiv = document.createElement('div');
            warningDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ffc107;
                color: #856404;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                max-width: 300px;
                font-size: 14px;
                border: 1px solid #ffeaa7;
            `;
            warningDiv.innerHTML = `
                <strong><i class="fas fa-exclamation-triangle"></i> æ±‡ç‡æé†’</strong><br>
                æ— æ³•è·å–å®æ—¶æ±‡ç‡ï¼Œæ­£åœ¨ä½¿ç”¨å¤‡ç”¨æ±‡ç‡ã€‚è¯·ç¡®è®¤æ”¯ä»˜é‡‘é¢åå†è¿›è¡Œè½¬è´¦ã€‚
            `;
            
            document.body.appendChild(warningDiv);
            
            setTimeout(() => {
                if (document.body.contains(warningDiv)) {
                    document.body.removeChild(warningDiv);
                }
            }, 8000);
        }
        
        // æ›´æ–°åŠ å¯†è´§å¸é‡‘é¢æ˜¾ç¤º
        function updateCryptoAmountDisplay() {
            const orderInfo = localStorage.getItem('orderInfo');
            if (!orderInfo) return;
            
            const order = JSON.parse(orderInfo);
            const cnyAmount = order.totalPrice; // äººæ°‘å¸é‡‘é¢
            const paymentMethod = order.paymentMethod?.toLowerCase();
            
            // æ›´æ–°TRXé‡‘é¢æ˜¾ç¤ºï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
            if (cryptoRates.trx) {
                const trxAmount = (cnyAmount / cryptoRates.trx).toFixed(2);
                const trxReminderElement = document.getElementById('trxAmountReminder');
                if (trxReminderElement) {
                    trxReminderElement.textContent = `${trxAmount} TRX`;
                }
            }
            
            // æ›´æ–°USDTé‡‘é¢æ˜¾ç¤ºï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
            if (cryptoRates.usdt) {
                const usdtAmount = (cnyAmount / cryptoRates.usdt).toFixed(2);
                const usdtReminderElement = document.getElementById('usdtAmountReminder');
                if (usdtReminderElement) {
                    usdtReminderElement.textContent = `${usdtAmount} USDT`;
                }
            }
            
            // æ ¹æ®å½“å‰é€‰æ‹©çš„æ”¯ä»˜æ–¹å¼æ˜¾ç¤ºå¯¹åº”çš„åŠ å¯†è´§å¸é‡‘é¢
            if (paymentMethod === 'trx' || paymentMethod === 'usdt') {
                const rate = cryptoRates[paymentMethod];
                if (rate) {
                    const cryptoAmount = (cnyAmount / rate).toFixed(2);
                    const cryptoCurrency = paymentMethod.toUpperCase();
                    
                    // æ˜¾ç¤ºåŠ å¯†è´§å¸é‡‘é¢
                    document.getElementById('cryptoAmount').textContent = `${cryptoAmount} ${cryptoCurrency}`;
                    document.getElementById('cryptoAmountDisplay').style.display = 'block';
                    
                    console.log(`Â¥${cnyAmount} äººæ°‘å¸ = ${cryptoAmount} ${cryptoCurrency} (æ±‡ç‡: 1 ${cryptoCurrency} = Â¥${rate} CNY)`);
                }
            } else {
                // éšè—åŠ å¯†è´§å¸é‡‘é¢æ˜¾ç¤º
                document.getElementById('cryptoAmountDisplay').style.display = 'none';
            }
        }
        
        // ç”ŸæˆäºŒç»´ç å‡½æ•°å·²ç§»é™¤ï¼Œç°åœ¨TRXå’ŒUSDTä½¿ç”¨å¤–é“¾å›¾ç‰‡
        // function generateQRCode(elementId, text) { ... }
        
        // æ›´æ–°ç½‘ç«™åç§°
        function updateSiteName() {
            if (config) {
                const siteName = config.siteName || 'BuyEdu';
                const siteDescription = config.siteDescription || 'ä¸“ä¸šçš„å­¦ç”Ÿé‚®ç®±å’Œæ•°å­—äº§å“é”€å”®å¹³å°';
                
                // æ›´æ–°é¡µé¢æ ‡é¢˜
                const pageTitle = document.getElementById('pageTitle');
                if (pageTitle) {
                    pageTitle.textContent = `æ”¯ä»˜é¡µé¢ - ${siteName}`;
                }
                
                // æ›´æ–°å¯¼èˆªæ ä¸­çš„ç½‘ç«™åç§°
                const siteNameElement = document.getElementById('siteName');
                if (siteNameElement) {
                    siteNameElement.textContent = siteName;
                }
            }
        }
        
        // åˆå§‹åŒ–æ”¯ä»˜é¡µé¢
        function initializePaymentPage() {
            const orderInfo = localStorage.getItem('orderInfo');
            if (orderInfo) {
                const order = JSON.parse(orderInfo);
                
                // æ›´æ–°é¡µé¢æ˜¾ç¤ºçš„è®¢å•ä¿¡æ¯
                document.getElementById('displayOrderNumber').textContent = order.orderNumber || 'IJUSHDSMWPZXKOMF';
                document.getElementById('displayOrderName').textContent = `${order.product} x ${order.quantity}`;
                document.getElementById('displayTotalPrice').textContent = `Â¥${order.totalPrice.toFixed(2)} äººæ°‘å¸`;
                document.getElementById('displayEmail').textContent = order.email;
                document.getElementById('displayPaymentMethod').textContent = order.paymentMethod || 'TRX';
                
                // æ›´æ–°è­¦å‘Šä¸­çš„é‡‘é¢
                document.getElementById('warningAmount').textContent = `Â¥${order.totalPrice.toFixed(2)}`;
                
                // æ ¹æ®æ”¯ä»˜æ–¹å¼è‡ªåŠ¨åˆ‡æ¢åˆ°å¯¹åº”çš„æ”¯ä»˜é€‰é¡¹
                const paymentMethod = order.paymentMethod?.toLowerCase() || 'usdt';
                switchPaymentMethod(paymentMethod);
            }
            
            // æ˜¾ç¤ºå¯ç”¨çš„ä»˜æ¬¾æ–¹å¼
            if (config.paymentMethods) {
                // æå–å¯ç”¨çš„æ”¯ä»˜æ–¹å¼ä»£ç 
                const enabledMethods = config.paymentMethods
                    .filter(method => method.enabled)
                    .map(method => {
                        const nameToCode = {
                            'æ”¯ä»˜å®': 'alipay',
                            'å¾®ä¿¡æ”¯ä»˜': 'wechat',
                            'å¾®ä¿¡': 'wechat',
                            'USDT': 'usdt',
                            'TRX': 'trx'
                        };
                        return nameToCode[method.name] || method.name.toLowerCase();
                    });
                
                document.querySelectorAll('.method-tab').forEach(tab => {
                    if (!enabledMethods.includes(tab.value)) {
                        tab.style.display = 'none';
                    }
                });
            }
        }
        
        // åˆ‡æ¢æ”¯ä»˜æ–¹å¼
        async function switchPaymentMethod(method) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.method-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[onclick="switchPaymentMethod('${method}')"]`).classList.add('active');
            
            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.method-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${method}Payment`).classList.add('active');
            
            // æ›´æ–°è®¢å•ä¿¡æ¯ä¸­çš„æ”¯ä»˜æ–¹å¼
            const orderInfo = localStorage.getItem('orderInfo');
            if (orderInfo) {
                const order = JSON.parse(orderInfo);
                order.paymentMethod = method.toUpperCase();
                localStorage.setItem('orderInfo', JSON.stringify(order));
                
                // æ›´æ–°é¡µé¢æ˜¾ç¤ºçš„æ”¯ä»˜æ–¹å¼
                document.getElementById('displayPaymentMethod').textContent = method.toUpperCase();
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦åŠ è½½æˆ–æ›´æ–°æ±‡ç‡
                const needsCryptoRates = method === 'trx' || method === 'usdt';
                const hasValidRates = cryptoRates.trx && cryptoRates.usdt;
                
                if (needsCryptoRates && !hasValidRates) {
                    console.log('åˆ‡æ¢åˆ°åŠ å¯†è´§å¸æ”¯ä»˜æ–¹å¼ï¼Œéœ€è¦åŠ è½½æ±‡ç‡');
                    await loadCryptoRates();
                } else if (needsCryptoRates) {
                    console.log('åˆ‡æ¢åˆ°åŠ å¯†è´§å¸æ”¯ä»˜æ–¹å¼ï¼Œä½¿ç”¨ç°æœ‰æ±‡ç‡');
                    // æ›´æ–°åŠ å¯†è´§å¸é‡‘é¢æ˜¾ç¤º
                    updateCryptoAmountDisplay();
                } else {
                    console.log('åˆ‡æ¢åˆ°ä¼ ç»Ÿæ”¯ä»˜æ–¹å¼ï¼Œæ— éœ€æ±‡ç‡');
                    // éšè—åŠ å¯†è´§å¸é‡‘é¢æ˜¾ç¤º
                    document.getElementById('cryptoAmountDisplay').style.display = 'none';
                }
            }
        }
        
        // å¤åˆ¶åœ°å€
        function copyAddress(inputId) {
            const input = document.getElementById(inputId);
            input.select();
            document.execCommand('copy');
            
            // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
            const copyBtn = input.nextElementSibling;
            const originalText = copyBtn.innerHTML;
            copyBtn.innerHTML = '<i class="fas fa-check"></i>';
            setTimeout(() => {
                copyBtn.innerHTML = originalText;
            }, 2000);
        }
        
        // å¼€å§‹æ”¯ä»˜å€’è®¡æ—¶
        function startPaymentTimer() {
            const timerDisplay = document.getElementById('paymentTimer');
            
            function updateTimer() {
                const minutes = Math.floor(remainingTime / 60);
                const seconds = remainingTime % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (remainingTime <= 0) {
                    clearInterval(paymentTimer);
                    handlePaymentTimeout();
                } else {
                    remainingTime--;
                }
            }
            
            updateTimer();
            paymentTimer = setInterval(updateTimer, 1000);
        }
        
        // å¤„ç†æ”¯ä»˜è¶…æ—¶
        function handlePaymentTimeout() {
            alert('æ”¯ä»˜å·²è¶…æ—¶ï¼Œè®¢å•å·²è‡ªåŠ¨å–æ¶ˆ');
            window.location.href = 'index.html';
        }
        
        // ç¡®è®¤æ”¯ä»˜
        function confirmPayment() {
            clearInterval(paymentTimer);
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ”¯ä»˜éªŒè¯é€»è¾‘
            
            // æ˜¾ç¤ºæ”¯ä»˜æˆåŠŸæç¤º
            alert('æ„Ÿè°¢æ‚¨çš„æ”¯ä»˜ï¼æˆ‘ä»¬ä¼šå°½å¿«å¤„ç†æ‚¨çš„è®¢å•ã€‚');
            
            // è·³è½¬åˆ°è®¢å•é¡µé¢æˆ–é¦–é¡µ
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1500);
        }
        
        // äºŒç»´ç æ‚¬åœæ”¾å¤§åŠŸèƒ½
        function initQrCodeHover() {
            // è·å–æ‰€æœ‰äºŒç»´ç å®¹å™¨
            const qrContainers = document.querySelectorAll('.qr-code-container');
            
            qrContainers.forEach(container => {
                const originalImg = container.querySelector('img');
                if (!originalImg) return;
                
                // åˆ›å»ºæ”¾å¤§çš„äºŒç»´ç å›¾ç‰‡
                const enlargedImg = document.createElement('img');
                enlargedImg.src = originalImg.src;
                enlargedImg.alt = originalImg.alt;
                enlargedImg.className = 'qr-enlarged';
                
                // å°†æ”¾å¤§çš„å›¾ç‰‡æ·»åŠ åˆ°å®¹å™¨ä¸­
                container.appendChild(enlargedImg);
                
                // åªç›‘å¬åŸå§‹å›¾ç‰‡çš„é¼ æ ‡äº‹ä»¶
                originalImg.addEventListener('mouseenter', function() {
                    enlargedImg.classList.add('show');
                });
                
                originalImg.addEventListener('mouseleave', function() {
                    enlargedImg.classList.remove('show');
                });
            });
        }
        

        
        // å¯¼èˆªæ åŠŸèƒ½å‡½æ•°
        function searchProducts() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (searchTerm) {
                window.location.href = `index.html?search=${encodeURIComponent(searchTerm)}`;
            }
        }

        function showOnlineService() {
            // è·³è½¬åˆ° Telegram è”ç³»å®¢æœ
            window.open('https://t.me/buymailbot1', '_blank');
        }

        function showConsultOrder() {
            // è·³è½¬åˆ°å’¨è¯¢è®¢å•é¡µé¢
            window.location.href = 'order-inquiry.html';
        }

        function goToHome() {
            window.location.href = 'index.html';
        }
    </script>
    <script src="js/script-loader.js"></script>
    <script src="js/analytics-loader.js"></script>
</body>
</html>