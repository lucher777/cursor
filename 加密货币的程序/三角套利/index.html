<!DOCTYPE html>
<html lang="zh-CN">

<head>

    <!-- ... 其他head内容 ... -->
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三角套利组合</title>
    <meta name="access-control-allow-origin" content="*">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

</head>

<body class="bg-gray-100 p-8">

    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">
        三角套利组合
    </h2>
    <div class="fetch-status">
        <p id="fetch-status">等待用户指令。。。</p>
    </div>


            <div class="flex justify-center space-x-4 mb-2">
            <!-- 收益率筛选输入框 -->
            <div class="flex items-center space-x-2">
                <label for="min-return-input" class="text-sm font-medium text-gray-700">最小收益率:</label>
                <input 
                    type="number" 
                    id="min-return-input" 
                    min="0" 
                    max="100" 
                    step="0.1" 
                    value="0.1" 
                    class="w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="0.1"
                >
                <span class="text-sm text-gray-500">%</span>
                <button 
                    id="save-return-btn" 
                    onclick="saveMinReturn()"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded text-sm">
                    保存
                </button>
            </div>
            <!-- 24小时成交量筛选输入框 -->
            <div class="flex items-center space-x-2">
                <label for="vol-24h-input" class="text-sm font-medium text-gray-700">24小时成交量:</label>
                <input 
                    type="number" 
                    id="vol-24h-input" 
                    min="0" 
                    step="1000" 
                    value="200000" 
                    class="w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="200000"
                >
                <span class="text-sm text-gray-500">USDT</span>
                <button 
                    id="save-vol-btn" 
                    onclick="saveVol24h()"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded text-sm">
                    保存
                </button>
            </div>
            <!-- 刷新按钮 -->
            <button id="refresh-button" onclick="refreshPanels()"
                class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
                刷新数据
            </button>
            <!-- API接口检测按钮 -->
            <a href="api_test.html" target="_blank"
                class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded">
                <i class="fas fa-cog mr-2"></i>API检测
            </a>
            <!-- 交易历史按钮 -->
            <a href="trade_history.html" target="_blank"
                class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded">
                <i class="fas fa-history mr-2"></i>交易历史
            </a>
        </div>


    <div class="stats text-center mb-8">

    </div>

    <!-- 修改交易所选择部分 -->
    <div class="flex flex-col md:flex-row gap-8">
        <!-- 面板1 -->
        <div class="exchange-panel exchange-panel1 bg-white p-6 rounded shadow-md w-[20%]" data-panel="1">
            <!-- 单选框选择区域 -->
            <div class="exchange-radios">

                <h4 class="">交易所:
                    <span class="exchange-count" id="arbitrage1-count">
                        <span></span>
                    </span>
                </h4>

                <div class="radio-div">
                    <template id="exchange-radio-template">
                        <label class="flex items-center space-x-2">
                            <input type="radio" name="exchange1" value="" class="hidden peer unselectable">
                            <span
                                class="px-2 py-1 bg-gray-200 hover:bg-gray-300 peer-checked:bg-blue-500 peer-checked:text-white rounded text-sm"></span>
                        </label>
                    </template>
                </div>
            </div>


            <table class="w-full">
                <thead>
                    <tr>
                        <th onclick="toggleSort(1, 'symbol')" class="sortable">
                            COIN <i class="fa-solid fa-sort fa-lg ml-2" id="sort-icon-1-symbol"></i>
                        </th>
                        <th onclick="toggleSort(1, 'price')" class="sortable">
                            PRICE <i class="fa-solid fa-sort fa-lg ml-2" id="sort-icon-1-price"></i>
                        </th>
                    </tr>
                </thead>
                <tbody class="exchange-rows" id="exchang-1panel-container">
                    <tr class="no-data-row">
                        <td colspan="4" class="text-center text-gray-500">请选择交易所查看数据</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="exchange-panel exchange-panel2 bg-white p-6 rounded shadow-md w-[80%]" data-panel="2">
            <h4 class="font-bold mb-2">信息面板
                <span id="exchang-4panel-count" class="exchange-count">
                    <span id="arbitrage-count" class="text-sm text-gray-600"></span>

                </span>
            </h4>
            <table class="w-full">
                <thead>
                    <tr>
                        <th onclick="toggleSort(4, 'symbol')" class="sortable">
                            # <i class="fa-solid fa-sort fa-lg ml-2" id="sort-icon-4-symbol"></i>
                        </th>
                        <th onclick="toggleSort(4, 'pair1')" class="sortable">
                            交易对1 <i class="fa-solid fa-sort fa-lg ml-2" id="sort-icon-4-pair1"></i>
                        </th>
                        <th onclick="toggleSort(4, 'pair2')" class="sortable">
                            交易对2 <i class="fa-solid fa-sort fa-lg ml-2" id="sort-icon-4-pair2"></i>
                        </th>

                        <th onclick="toggleSort(4, 'pair3')" class="sortable">
                            交易对3 <i class="fa-solid fa-sort fa-lg ml-2" id="sort-icon-4-pair3"></i>
                        </th>

                        <th onclick="toggleSort(4, 'path1')" class="sortable">
                            路径1 （起始币数量*【1】*【3】/【2】）<i class="fa-solid fa-sort fa-lg ml-2"
                                id="sort-icon-4-path1"></i>
                        </th>

                        <th onclick="toggleSort(4, 'profit1')" class="sortable">
                            收益1 <i class="fa-solid fa-sort fa-lg ml-2" id="sort-icon-4-profit1"></i>
                        </th>

                        <th onclick="toggleSort(4, 'path2')" class="sortable">
                            路径2 （起始币数量*【2】/【1】/【3】） <i class="fa-solid fa-sort fa-lg ml-2"
                                id="sort-icon-4-path2"></i>
                        </th>

                        <th onclick="toggleSort(4, 'profit2')" class="sortable">
                            收益2<i class="fa-solid fa-sort fa-lg ml-2" id="sort-icon-4-profit2"></i>
                        </th>
                        <th class="sortable">
                            操作
                        </th>
                        

                    </tr>
                </thead>
                <tbody id="exchang-4panel-container" class="space-y-6">
  
                    <tr class="no-data-row">
                        <td style="height: 500px;" colspan="8" class="text-center text-gray-500">请先选择交易所</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>


    <script type="module">
        import {getCoinPrices} from './coingecko_fetcher.js';
        import { init, toggleSort, refreshPanels, toggleAllLinks, saveMinReturn, saveVol24h } from './script.js';
        import { QuickTrade } from './quick_trade.js';

        // 初始化一键交易功能
        let quickTradeInstance = null;

        window.toggleSort = toggleSort;
        window.addEventListener('load', async () => {
            await getCoinPrices();
            await init();
            
            // 初始化一键交易
            quickTradeInstance = new QuickTrade();
        });
        
        window.getCoinPrices = getCoinPrices;
        window.refreshPanels = refreshPanels;
        window.toggleAllLinks = toggleAllLinks;
        window.saveMinReturn = saveMinReturn;
        window.saveVol24h = saveVol24h;
        
        // 一键交易执行函数
        window.executeQuickTrade = function(button) {
            if (quickTradeInstance) {
                const arbitrageData = JSON.parse(button.dataset.arbitrage);
                quickTradeInstance.executeArbitrage(arbitrageData);
            } else {
                alert('一键交易功能未初始化，请刷新页面重试');
            }
        };

    </script>
</body>

</html>